!function(a,b,c){"use strict";function d(a,b,c,d,e,f){var g=0;return a>b&&a>c?(e<a&&(g|=2),f<a&&(g|=1)):b>c?(d<b&&(g|=4),f<b&&(g|=1)):(d<c&&(g|=4),e<c&&(g|=2)),g}function e(a,b,c,d){var e=void 0,f=0;return b<c?(e=b,f=0):(e=c,f=1),d<e&&(f=2),s[a][f]}function f(a,b,c,g,h,i,j,k,l){var m=a.children,n=void 0,o=void 0,p=void 0,q=void 0;if(h>=0&&i>=0&&j>=0)if(null===m)l.push(a);else{o=.5*(b+h),p=.5*(c+i),q=.5*(g+j),n=d(b,c,g,o,p,q);do switch(n){case 0:f(m[r[8]],b,c,g,o,p,q,k,l),n=e(n,o,p,q);break;case 1:f(m[r[8]^r[1]],b,c,q,o,p,j,k,l),n=e(n,o,p,j);break;case 2:f(m[r[8]^r[2]],b,p,g,o,i,q,k,l),n=e(n,o,i,q);break;case 3:f(m[r[8]^r[3]],b,p,q,o,i,j,k,l),n=e(n,o,i,j);break;case 4:f(m[r[8]^r[4]],o,c,g,h,p,q,k,l),n=e(n,h,p,q);break;case 5:f(m[r[8]^r[5]],o,c,q,h,p,j,k,l),n=e(n,h,p,j);break;case 6:f(m[r[8]^r[6]],o,p,g,h,i,q,k,l),n=e(n,h,i,q);break;case 7:f(m[r[8]^r[7]],o,p,q,h,i,j,k,l),n=8}while(n<8)}}b="default"in b?b.default:b,c="default"in c?c.default:c;var g=(function(){function a(a){this.value=a}function b(b){function c(a,b){return new Promise(function(c,e){var h={key:a,arg:b,resolve:c,reject:e,next:null};g?g=g.next=h:(f=g=h,d(a,b))})}function d(c,f){try{var g=b[c](f),h=g.value;h instanceof a?Promise.resolve(h.value).then(function(a){d("next",a)},function(a){d("throw",a)}):e(g.done?"return":"normal",g.value)}catch(a){e("throw",a)}}function e(a,b){switch(a){case"return":f.resolve({value:b,done:!0});break;case"throw":f.reject(b);break;default:f.resolve({value:b,done:!1})}f=f.next,f?d(f.key,f.arg):g=null}var f,g;this._invoke=c,"function"!=typeof b.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(b.prototype[Symbol.asyncIterator]=function(){return this}),b.prototype.next=function(a){return this._invoke("next",a)},b.prototype.throw=function(a){return this._invoke("throw",a)},b.prototype.return=function(a){return this._invoke("return",a)},{wrap:function(a){return function(){return new b(a.apply(this,arguments))}},await:function(b){return new a(b)}}}(),function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}),h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},j=function(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)},k=function(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b},l=function(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)},m=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;g(this,a),this.x=b,this.y=c,this.z=d}return h(a,[{key:"set",value:function(a,b,c){return this.x=a,this.y=b,this.z=c,this}},{key:"copy",value:function(a){return this.x=a.x,this.y=a.y,this.z=a.z,this}},{key:"fromArray",value:function(a,b){return void 0===b&&(b=0),this.x=a[b],this.y=a[b+1],this.z=a[b+2],this}},{key:"toArray",value:function(a,b){return void 0===a&&(a=[]),void 0===b&&(b=0),a[b]=this.x,a[b+1]=this.y,a[b+2]=this.z,a}},{key:"equals",value:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"add",value:function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this}},{key:"addScaledVector",value:function(a,b){return this.x+=a.x*b,this.y+=a.y*b,this.z+=a.z*b,this}},{key:"addScalar",value:function(a){return this.x+=a,this.y+=a,this.z+=a,this}},{key:"addVectors",value:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this}},{key:"sub",value:function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this}},{key:"subScalar",value:function(a){return this.x-=a,this.y-=a,this.z-=a,this}},{key:"subVectors",value:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this}},{key:"multiply",value:function(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this}},{key:"multiplyScalar",value:function(a){return isFinite(a)?(this.x*=a,this.y*=a,this.z*=a):(this.x=0,this.y=0,this.z=0),this}},{key:"multiplyVectors",value:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this}},{key:"divide",value:function(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this}},{key:"divideScalar",value:function(a){return this.multiplyScalar(1/a)}},{key:"divideVectors",value:function(a,b){return this.x=a.x/b.x,this.y=a.y/b.y,this.z=a.z/b.z,this}},{key:"dot",value:function(a){return this.x*a.x+this.y*a.y+this.z*a.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"distanceTo",value:function(a){return Math.sqrt(this.distanceToSquared(a))}},{key:"distanceToSquared",value:function(a){var b=this.x-a.x,c=this.y-a.y,d=this.z-a.z;return b*b+c*c+d*d}},{key:"normalize",value:function(){return this.divideScalar(this.length())}},{key:"min",value:function(a){return this.x=Math.min(this.x,a.x),this.y=Math.min(this.y,a.y),this.z=Math.min(this.z,a.z),this}},{key:"max",value:function(a){return this.x=Math.max(this.x,a.x),this.y=Math.max(this.y,a.y),this.z=Math.max(this.z,a.z),this}},{key:"clamp",value:function(a,b){return this.x=Math.max(a.x,Math.min(b.x,this.x)),this.y=Math.max(a.y,Math.min(b.y,this.y)),this.z=Math.max(a.z,Math.min(b.z,this.z)),this}},{key:"applyMatrix3",value:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[3]*c+e[6]*d,this.y=e[1]*b+e[4]*c+e[7]*d,this.z=e[2]*b+e[5]*c+e[8]*d,this}},{key:"applyMatrix4",value:function(a){var b=this.x,c=this.y,d=this.z,e=a.elements;return this.x=e[0]*b+e[4]*c+e[8]*d+e[12],this.y=e[1]*b+e[5]*c+e[9]*d+e[13],this.z=e[2]*b+e[6]*c+e[10]*d+e[14],this}}]),a}(),n=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new m,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new m;g(this,a),this.min=b,this.max=c,this.children=null}return h(a,[{key:"getCenter",value:function(){return this.min.clone().add(this.max).multiplyScalar(.5)}},{key:"getDimensions",value:function(){return this.max.clone().sub(this.min)}},{key:"split",value:function(a){var b=this.min,c=this.max,d=this.getCenter(),e=void 0,f=void 0,g=0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0;for(Array.isArray(a)&&(i=this.getDimensions().multiplyScalar(.5),j=[new m,new m,new m],g=a.length),this.children=[],e=0;e<8;++e){if(h=o[e],l=null,g>0)for(j[1].addVectors(b,j[0].fromArray(h).multiply(i)),j[2].addVectors(d,j[0].fromArray(h).multiply(i)),f=0;f<g;++f)if(k=a[f],null!==k&&j[1].equals(k.min)&&j[2].equals(k.max)){l=k,a[f]=null;break}this.children.push(null!==l?l:new this.constructor(new m(0===h[0]?b.x:d.x,0===h[1]?b.y:d.y,0===h[2]?b.z:d.z),new m(0===h[0]?d.x:c.x,0===h[1]?d.y:c.y,0===h[2]?d.z:c.z)))}}}]),a}(),o=[new Uint8Array([0,0,0]),new Uint8Array([0,0,1]),new Uint8Array([0,1,0]),new Uint8Array([0,1,1]),new Uint8Array([1,0,0]),new Uint8Array([1,0,1]),new Uint8Array([1,1,0]),new Uint8Array([1,1,1])],p=[new Uint8Array([0,4]),new Uint8Array([1,5]),new Uint8Array([2,6]),new Uint8Array([3,7]),new Uint8Array([0,2]),new Uint8Array([1,3]),new Uint8Array([4,6]),new Uint8Array([5,7]),new Uint8Array([0,1]),new Uint8Array([2,3]),new Uint8Array([4,5]),new Uint8Array([6,7])],q=(function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new m,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;g(this,a),this.min=b,this.size=c,this.children=null}return h(a,[{key:"getCenter",value:function(){return this.min.clone().addScalar(.5*this.size)}},{key:"getDimensions",value:function(){return new m(this.size,this.size,this.size)}},{key:"split",value:function(a){var b=this.min,c=this.getCenter(),d=.5*this.size,e=void 0,f=void 0,g=0,h=void 0,i=void 0,j=void 0,k=void 0;for(Array.isArray(a)&&(i=new m,g=a.length),this.children=[],e=0;e<8;++e){if(h=o[e],k=null,g>0)for(i.fromArray(h).multiplyScalar(d).add(b),f=0;f<g;++f)if(j=a[f],null!==j&&j.size===d&&i.equals(j.min)){k=j,a[f]=null;break}this.children.push(null!==k?k:new this.constructor(new m(0===h[0]?b.x:c.x,0===h[1]?b.y:c.y,0===h[2]?b.z:c.z),d))}}},{key:"max",get:function(){return this.min.clone().addScalar(this.size)}}]),a}(),function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new m(1/0,1/0,1/0),c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new m(-(1/0),-(1/0),-(1/0));g(this,a),this.min=b,this.max=c}return h(a,[{key:"set",value:function(a,b){return this.min.copy(a),this.max.copy(b),this}},{key:"copy",value:function(a){return this.min.copy(a.min),this.max.copy(a.max),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"expandByPoint",value:function(a){return this.min.min(a),this.max.max(a),this}},{key:"union",value:function(a){return this.min.min(a.min),this.max.max(a.max),this}},{key:"setFromPoints",value:function(a){var b=void 0,c=void 0;for(b=0,c=a.length;b<c;++b)this.expandByPoint(a[b]);return this}},{key:"setFromCenterAndSize",value:function(a,b){var c=b.clone().multiplyScalar(.5);return this.min.copy(a).sub(c),this.max.copy(a).add(c),this}},{key:"intersectsBox",value:function(a){return!(a.max.x<this.min.x||a.min.x>this.max.x||a.max.y<this.min.y||a.min.y>this.max.y||a.max.z<this.min.z||a.min.z>this.max.z)}}]),a}()),r=new Uint8Array([0,1,2,3,4,5,6,7,0]),s=[new Uint8Array([4,2,1]),new Uint8Array([5,3,8]),new Uint8Array([6,8,3]),new Uint8Array([7,8,8]),new Uint8Array([8,6,5]),new Uint8Array([8,7,8]),new Uint8Array([8,8,7]),new Uint8Array([8,8,8])],t=function(){function a(){g(this,a)}return h(a,null,[{key:"raycast",value:function(a,b,c){var d=a.getDimensions(),e=d.clone().multiplyScalar(.5),g=a.min.clone().sub(a.min),h=a.max.clone().sub(a.min),i=b.ray.direction.clone(),j=b.ray.origin.clone();j.sub(a.getCenter()).add(e);var k=void 0,l=void 0,m=void 0,n=void 0,o=void 0,p=void 0,q=void 0,s=void 0,t=void 0;r[8]=r[0],i.x<0&&(j.x=d.x-j.x,i.x=-i.x,r[8]|=r[4]),i.y<0&&(j.y=d.y-j.y,i.y=-i.y,r[8]|=r[2]),i.z<0&&(j.z=d.z-j.z,i.z=-i.z,r[8]|=r[1]),k=1/i.x,l=1/i.y,m=1/i.z,n=(g.x-j.x)*k,o=(h.x-j.x)*k,p=(g.y-j.y)*l,q=(h.y-j.y)*l,s=(g.z-j.z)*m,t=(h.z-j.z)*m,Math.max(Math.max(n,p),s)<Math.min(Math.min(o,q),t)&&f(a.root,n,p,s,o,q,t,b,c)}}]),a}(),u=function(){function a(b,c){g(this,a),this.root=void 0!==b&&void 0!==c?new n(b,c):null}return h(a,[{key:"getCenter",value:function(){return this.root.getCenter()}},{key:"getDimensions",value:function(){return this.root.getDimensions()}},{key:"getDepth",value:function(){for(var a=[this.root],b=[],c=0,d=void 0,e=void 0;a.length>0;){if(d=a.pop(),e=d.children,null!==e){var f;(f=b).push.apply(f,l(e))}0===a.length&&(a=b,b=[],a.length>0&&++c)}return c}},{key:"cull",value:function(a){for(var b=[],c=[this.root],d=new q,e=void 0,f=void 0;c.length>0;)e=c.pop(),f=e.children,d.min=e.min,d.max=e.max,a.intersectsBox(d)&&(null!==f?c.push.apply(c,l(f)):b.push(e));return b}},{key:"findOctantsByLevel",value:function(a){for(var b=[],c=[this.root],d=[],e=void 0,f=void 0,g=0;c.length>0;){if(e=c.pop(),f=e.children,g===a)b.push(e);else if(null!==f){var h;(h=d).push.apply(h,l(f))}if(0===c.length&&(c=d,d=[],++g>a))break}return b}},{key:"raycast",value:function(a,b){t.raycast(this,a,b)}},{key:"min",get:function(){return this.root.min}},{key:"max",get:function(){return this.root.max}},{key:"children",get:function(){return this.root.children}}]),a}(),v=function(b){function c(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;g(this,c);var b=k(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));return b.name="OctreeHelper",b.octree=a,b.update(),b}return j(c,b),h(c,[{key:"createLineSegments",value:function(b){var c=Math.pow(2,16)/8-1,d=new a.Object3D,e=new a.LineBasicMaterial({color:16777215*Math.random()}),f=b.length,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m=void 0,n=void 0,q=void 0,r=void 0,s=void 0,t=void 0,u=void 0,v=void 0,w=void 0;for(q=0,h=0,u=Math.ceil(f/c);u>0;--u){for(h+=f<c?f:c,f-=c,g=8*h,i=new Uint16Array(3*g),j=new Float32Array(3*g),s=0,t=0;q<h;++q){for(k=b[q],l=k.min,m=k.max,r=0;r<12;++r)w=p[r],i[t++]=s+w[0],i[t++]=s+w[1];for(r=0;r<8;++r,++s)v=o[r],j[3*s]=0===v[0]?l.x:m.x,j[3*s+1]=0===v[1]?l.y:m.y,j[3*s+2]=0===v[2]?l.z:m.z}n=new a.BufferGeometry,n.setIndex(new a.BufferAttribute(i,1)),n.addAttribute("position",new a.BufferAttribute(j,3)),d.add(new a.LineSegments(n,e))}this.add(d)}},{key:"update",value:function(){var a=null!==this.octree?this.octree.getDepth():-1,b=0;for(this.dispose();b<=a;)this.createLineSegments(this.octree.findOctantsByLevel(b)),++b}},{key:"dispose",value:function(){var a=void 0,b=void 0,c=void 0,d=void 0,e=void 0,f=void 0;for(c=0,e=this.children.length;c<e;++c){for(a=this.children[c],b=a.children,d=0,f=b.length;d<f;++d)b[d].geometry.dispose(),b[d].material.dispose();for(;b.length>0;)a.remove(b[0])}for(;this.children.length>0;)this.remove(b[0])}}]),c}(a.Object3D),w=function(a){function b(a,c){g(this,b);var d=k(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return d.points=null,d.data=null,d}return j(b,a),h(b,[{key:"countPoints",value:function(){for(var a=[this],b=0,c=void 0,d=void 0;a.length>0;)c=a.pop(),d=c.children,null!==d?a.push.apply(a,l(d)):null!==c.points&&(b+=c.points.length);return b}},{key:"distanceToSquared",value:function(a){var b=a.clone().clamp(this.min,this.max);return b.sub(a).lengthSq()}},{key:"distanceToCenterSquared",value:function(a){var b=this.getCenter(),c=a.x-b.x,d=a.y-b.x,e=a.z-b.z;return c*c+d*d+e*e}},{key:"contains",value:function(a,b){var c=this.min,d=this.max;return a.x>=c.x-b&&a.y>=c.y-b&&a.z>=c.z-b&&a.x<=d.x+b&&a.y<=d.y+b&&a.z<=d.z+b}},{key:"redistribute",value:function(a){var b=this.children,c=this.points,d=void 0,e=void 0,f=void 0,g=void 0,h=void 0;if(null!==b)for(;c.length>0;)for(g=c.pop(),h=this.data.pop(),d=0,e=b.length;d<e;++d)if(f=b[d],f.contains(g,a)){null===f.points&&(f.points=[],f.data=[]),f.points.push(g),f.data.push(h);break}this.points=null,this.data=null}},{key:"merge",value:function(){var a=this.children,b=void 0,c=void 0,d=void 0;if(null!==a){for(this.points=[],this.data=[],b=0,c=a.length;b<c;++b)if(d=a[b],null!==d.points){var e,f;(e=this.points).push.apply(e,l(d.points)),(f=this.data).push.apply(f,l(d.data))}this.children=null}}},{key:"findNearestPoint",value:function(a,b,c){var d=this.points,e=this.children,f=null,g=b,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m=void 0,n=void 0;if(null!==e)for(l=e.map(function(b){return{octant:b,distance:b.distanceToCenterSquared(a)}}).sort(function(a,b){return a.distance-b.distance}),h=0,i=l.length;h<i;++h)m=l[h].octant,m.contains(a,g)&&(n=m.findNearestPoint(a,g,c),null!==n&&(k=n.point.distanceToSquared(a),(!c||k>0)&&k<g&&(g=k,f=n)));else if(null!==d)for(h=0,i=d.length;h<i;++h)j=d[h],k=a.distanceToSquared(j),(!c||k>0)&&k<g&&(g=k,f={point:j.clone(),data:this.data[h]});return f}},{key:"findPoints",value:function(a,b,c,d){var e=this.points,f=this.children,g=b*b,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0;if(null!==f)for(h=0,i=f.length;h<i;++h)l=f[h],l.contains(a,b)&&l.findPoints(a,b,c,d);else if(null!==e)for(h=0,i=e.length;h<i;++h)j=e[h],k=a.distanceToSquared(j),(!c||k>0)&&k<=g&&d.push({point:j.clone(),data:this.data[h]})}}]),b}(n),x=function(a){function b(a,c){var d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:8;g(this,b);var h=k(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return h.root=new w(a,c),h.bias=Math.max(0,d),h.biasSquared=h.bias*h.bias,h.maxPoints=Math.max(1,Math.round(e)),h.maxDepth=Math.max(0,Math.round(f)),h}return j(b,a),h(b,[{key:"countPoints",value:function(){return this.root.countPoints()}},{key:"add",value:function(a,b){a=a.clone();var c=[this.root],d=0,e=void 0,f=void 0,g=void 0,h=void 0,i=!1;if(void 0!==b&&null!==b)for(;c.length>0;)if(e=c.pop(),f=e.children,e.contains(a,this.bias))if(c=[],null!==f){var j;(j=c).push.apply(j,l(f)),++d}else{if(null===e.points)e.points=[],e.data=[];else for(g=0,h=e.points.length;!i&&g<h;++g)i=e.points[g].equals(a);if(i)e.data[g-1]=b;else if(e.points.length<this.maxPoints||d===this.maxDepth)e.points.push(a),e.data.push(b);else{var k;e.split(),e.redistribute(this.bias),(k=c).push.apply(k,l(e.children)),++d}}}},{key:"remove",value:function(a){for(var b=[this.root],c=this.root,d=void 0,e=void 0,f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0;b.length>0;)if(d=b.pop(),e=d.children,d.contains(a,this.bias))if(b=[],null!==e){var m;(m=b).push.apply(m,l(e)),c=d}else if(null!==d.points)for(h=d.points,i=d.data,f=0,g=h.length;f<g;++f)if(j=h[f],j.equals(a)){k=g-1,f<k&&(h[f]=h[k],i[f]=i[k]),h.pop(),i.pop(),c.countPoints()<=this.maxPoints&&c.merge();break}}},{key:"fetch",value:function(a){for(var b=[this.root],c=null,d=void 0,e=void 0,f=void 0,g=void 0,h=void 0;b.length>0;)if(d=b.pop(),e=d.children,d.contains(a,this.bias))if(b=[],null!==e){var i;(i=b).push.apply(i,l(e))}else for(f=0,g=d.points.length;f<g;++f)if(h=d.points[f],a.distanceToSquared(h)<=this.biasSquared){c=d.data[f];break}return c}},{key:"findNearestPoint",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.root.findNearestPoint(a,b,c)}},{key:"findPoints",value:function(a,b){var c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=[];return this.root.findPoints(a,b,c,d),d}},{key:"raycast",value:function(a,c){var d=[];i(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"raycast",this).call(this,a,d),d.length>0&&this.testPoints(d,a,c)}},{key:"testPoints",value:function(a,b,c){var d=b.params.Points.threshold,e=d*d,f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0,m=void 0,n=void 0,o=void 0,p=void 0;for(j=0,l=a.length;j<l;++j)if(n=a[j],o=n.points,null!==o)for(k=0,m=o.length;k<m;++k)p=o[k],i=b.ray.distanceSqToPoint(p),i<e&&(f=b.ray.closestPointToPoint(p),g=b.ray.origin.distanceTo(f),g>=b.near&&g<=b.far&&(h=Math.sqrt(i),c.push({distance:g,distanceToRay:h,point:f.clone(),object:n.data[k]})))}}]),b}(u),y=new a.Vector2,z=function(a){function b(a,c,d){g(this,b);var e=k(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return e.params.Points.threshold=.1,e.octree=a,e.camera=c,e.object=d,e.enabled=!0,e.delta="",e.selection=null,e}return j(b,a),h(b,[{key:"raycast",value:function(a){var b=void 0,c=void 0,d=void 0;y.x=a.clientX/window.innerWidth*2-1,y.y=2*-(a.clientY/window.innerHeight)+1,this.setFromCamera(y,this.camera),this.enabled?(c=performance.now(),b=this.intersectObject(this.octree),d=performance.now()):(c=performance.now(),b=this.intersectObjects(this.object.children),d=performance.now()),this.delta=(100*(d-c)/100).toFixed(2)+" ms",null!==this.selection&&(this.selection.material.color.setHex(12582912),this.selection=null),b.length>0&&(void 0!==b[0].object?(this.selection=b[0].object,this.selection.material.color.setHex(13434624)):console.warn(b))}},{key:"configure",value:function(a){var b=a.addFolder("Raycasting");b.add(this,"enabled"),b.add(this,"delta").listen(),b.open()}}]),b}(a.Raycaster),A=new a.Matrix4,B=new a.Frustum,C=function(){function b(c,d){g(this,b),this.octree=c,this.scene=d,this.enabled=!1,this.cullCamera=new a.PerspectiveCamera(20,1.77,.5,5),this.cullCamera.matrixAutoUpdate=!1,this.s=new a.Spherical(5,Math.PI/3,1.75*Math.PI),this.delta="",this.culledOctants=new a.Points(new a.BufferGeometry,new a.PointsMaterial({color:13434624,sizeAttenuation:!1,size:1})),this.culledOctants.visible=!1,this.cameraHelper=new a.CameraHelper(this.cullCamera),this.cameraHelper.visible=!1}return h(b,[{key:"updateCamera",value:function(){var a=this.cullCamera;a.position.setFromSpherical(this.s),a.lookAt(this.scene.position),a.updateMatrix(),a.updateMatrixWorld(),a.matrixWorldInverse.getInverse(a.matrixWorld),B.setFromMatrix(A.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse))}},{key:"cull",value:function(){var b=this.culledOctants,c=void 0,d=void 0,e=void 0,f=void 0,g=void 0,h=void 0,i=void 0;if(this.enabled)if(this.updateCamera(),c=performance.now(),h=this.octree.cull(B),this.delta=(100*(performance.now()-c)/100).toFixed(2)+" ms",h.length>0){for(i=new Float32Array(3*h.length*2),d=0,e=0,f=h.length;d<f;++d)g=h[d],i[e++]=g.min.x,i[e++]=g.min.y,i[e++]=g.min.z,i[e++]=g.max.x,i[e++]=g.max.y,i[e++]=g.max.z;b.geometry.removeAttribute("position"),b.geometry.addAttribute("position",new a.BufferAttribute(i,3)),this.scene.remove(b),this.scene.add(b)}else this.scene.remove(b)}},{key:"configure",value:function(a){var b=this,c=a.addFolder("Frustum Culling");c.add(this,"enabled").onChange(function(){b.cameraHelper.visible=b.culledOctants.visible=b.enabled,b.cull()}),c.add(this,"delta").listen(),c.open();var d=c.addFolder("Camera Adjustment");d.add(this.s,"radius").min(.1).max(10).step(.1).onChange(function(){b.s.radius=b.s.radius,b.cull()}),d.add(this.s,"phi").min(1e-6).max(Math.PI-1e-6).onChange(function(){b.s.phi=b.s.phi,b.cull()}),d.add(this.s,"theta").min(0).max(2*Math.PI).onChange(function(){b.s.theta=b.s.theta,b.cull()})}}]),b}(),D=function(){function d(){g(this,d)}return h(d,null,[{key:"initialise",value:function(d,e,f){var g=window.innerWidth,h=window.innerHeight,i=g/h,j=new a.Scene;j.fog=new a.FogExp2(855309,.025);var k=new a.WebGLRenderer({logarithmicDepthBuffer:!0,antialias:!0});k.setSize(g,h),k.setClearColor(j.fog.color),k.setPixelRatio(window.devicePixelRatio),d.appendChild(k.domElement);var l=new a.PerspectiveCamera(50,i,.1,200),m=new a.OrbitControls(l,k.domElement);m.target.set(0,0,0),m.maxDistance=60,l.position.set(10,6,10),l.lookAt(m.target),j.add(l);var n=new c;n.showPanel(0),n.dom.id="stats",e.appendChild(n.dom);var o=new b.GUI;e.appendChild(o.domElement.parentNode),j.add(new a.AxisHelper(1));var p=function(){function b(b,c,d){var e=new a.BufferGeometry,f=new Float32Array(3*b),g=c/2,h=void 0,i=void 0,j=void 0,k=void 0;for(j=0,k=f.length;j<k;j+=3)h=Math.random()*c-g,i=Math.random()*c-g,f[j]=h,f[j+1]=i,f[j+2]=d;return e.addAttribute("position",new a.BufferAttribute(f,3)),e}for(var c=new a.Object3D,d=128,e=128,f=8,g=6,h=g/(f-1),i=g*-.5,j=void 0,k=new a.PointsMaterial({color:12582912,sizeAttenuation:!1,size:1});f-- >0;)j=new a.Points(b(d*e,g,i),k),k=k.clone(),i+=h,c.add(j);return c}();j.add(p);var q=function(b){var c=new a.Vector3,d=new a.Box3;d.setFromObject(j);var e=performance.now(),f=void 0,g=void 0,h=void 0,i=void 0,k=void 0,l=new x(d.min,d.max,0,8,5);for(f=b.children.length-1;f>=0;--f)for(g=b.children[f],k=g.geometry.getAttribute("position").array,h=0,i=k.length;h<i;h+=3)l.add(c.fromArray(k,h),g);return console.log("Octree:",l,"created in",(100*(performance.now()-e)/100).toFixed(2)+" ms"),l}(p),r=function(a){var b=performance.now(),c=new v(a);return c.visible=!1,console.log("OctreeHelper:",c,"created in",(100*(performance.now()-b)/100).toFixed(2)+" ms"),c}(q);j.add(r);var s=new z(q,l,p);s.configure(o),d.addEventListener("mousemove",function(a){s.raycast(a)});var t=new C(q,j);t.configure(o),j.add(t.cullCamera),j.add(t.cameraHelper);var u={"level mask":r.children.length},w=o.addFolder("Points");w.add(p,"visible"),w.open(),w=o.addFolder("Octree Helper"),w.add(r,"visible"),w.add(u,"level mask").min(0).max(r.children.length).step(1).onChange(function(){var a=void 0,b=void 0;for(a=0,b=r.children.length;a<b;++a)r.children[a].visible=u["level mask"]===r.children.length||a===u["level mask"]}),w.open(),document.addEventListener("keydown",function(a){a.altKey&&(a.preventDefault(),e.style.visibility="hidden"===e.style.visibility?"visible":"hidden")}),window.addEventListener("resize",function(a){var b=a.target.innerWidth,c=a.target.innerHeight;k.setSize(b,c),l.aspect=b/c,l.updateProjectionMatrix()}),function a(b){requestAnimationFrame(a),n.begin(),t.cameraHelper.update(),k.render(j,l),n.end()}()}}]),d}();window.addEventListener("load",function b(c){window.removeEventListener("load",b);var d=new Map,e=new a.LoadingManager;e.onProgress=function(a,b,c){b===c&&D.initialise(document.getElementById("viewport"),document.getElementById("aside"),d)},e.onProgress()})}(THREE,dat,Stats);